(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0140d5f7"],{"1e01":function(a,e,t){"use strict";t.d(e,"b",(function(){return i})),t.d(e,"c",(function(){return n})),t.d(e,"a",(function(){return o})),t.d(e,"d",(function(){return r}));var s=t("b775"),l={folderList:"/fileSystem/listFolder",imageList:"/fileSystem/listImage",addFolder:"/fileSystem/addFolder",removeFile:"/fileSystem/remove"};function i(a){return Object(s["b"])({url:l.folderList,method:"get",params:a})}function n(a){return Object(s["b"])({url:l.imageList,method:"get",params:a})}function o(a){return Object(s["b"])({url:l.addFolder,method:"post",params:a})}function r(a){return Object(s["b"])({url:l.removeFile,method:"delete",params:a})}},"838d":function(a,e,t){"use strict";t.r(e);var s=function(){var a=this,e=this,t=e.$createElement,s=e._self._c||t;return s("a-card",{attrs:{bordered:!1}},[s("div",[s("a-row",{attrs:{gutter:0}},[s("a-col",{attrs:{md:10,sm:24}},[s("a-form",{attrs:{layout:"inline"}},[s("a-form-item",[s("a-button",{attrs:{icon:"folder-add",type:"primary"},on:{click:function(a){return e.showUploadModal()}}},[e._v("上传图片")])],1)],1)],1),s("a-col",{attrs:{md:14,sm:24}},[s("a-form",{attrs:{layout:"inline"}},[s("a-form-item",{attrs:{label:"文件名称"}},[s("a-input",{attrs:{placeholder:"文件名称"},model:{value:e.queryParam.name,callback:function(a){e.$set(e.queryParam,"name",a)},expression:"queryParam.name"}})],1),s("a-form-item",[s("a-button",{on:{click:function(a){return e.loadData()}}},[e._v("查询")]),s("a-button",{staticStyle:{"margin-left":"8px"},on:{click:function(){return a.queryParam={}}}},[e._v("重置")]),s("a-button",{staticStyle:{"margin-left":"8px"},attrs:{type:"primary"},on:{click:function(a){return e.onClickAnalysis()}}},[e._v("分析")])],1)],1)],1)],1)],1),s("a-table",{attrs:{"data-source":e.dataSource,rowSelection:e.rowSelection,rowKey:"name"}},[s("a-table-column",{key:"name",attrs:{title:"文件名","data-index":"name"},scopedSlots:e._u([{key:"default",fn:function(a,t){return[s("a",{staticStyle:{"padding-right":"50px","font-size":"16px"},on:{click:function(a){return e.onClickImage(t.name,t.resourcePath,t.canonicalFilePath)}}},[s("a-icon",{staticStyle:{fontSize:"20px","margin-right":"10px"},attrs:{type:"file-text",theme:"filled"}}),s("span",{staticStyle:{color:"black"}},[e._v(e._s(t.name))])],1)]}}])}),s("a-table-column",{key:"createDate",attrs:{title:"修改时间","data-index":"lastModified"},scopedSlots:e._u([{key:"default",fn:function(a,t){return[e._v(" "+e._s(e.formatDate(t.lastModified))+" ")]}}])}),s("a-table-column",{key:"action",attrs:{title:"操作"},scopedSlots:e._u([{key:"default",fn:function(a,t){return[s("span",[s("a-button",{on:{click:function(a){return e.deleteFile(t)}}},[e._v("删除")]),s("a-button",{staticStyle:{"margin-left":"5px"},attrs:{type:"primary"},on:{click:function(a){return e.onClickAnalysis(t)}}},[e._v("分析")]),s("a-button",{staticStyle:{"margin-left":"5px"},attrs:{type:"primary"},on:{click:function(a){return e.onClickAnalysisResult(t)}}},[e._v("分析结果")])],1)]}}])})],1),s("a-drawer",{attrs:{title:e.image.name,placement:"left",closable:!0,maskClosable:!1,visible:e.image.showModal,width:"90%"},on:{close:e.handleImageModalCancel}},[s("a",{staticStyle:{"font-size":"20px",border:"silver 1px"},attrs:{href:e.image.resourcePath,download:e.image.name}},[e._v("下载")]),s("span",{staticStyle:{"margin-left":"20px"}},[e._v("文件路径 "+e._s(e.image.canonicalFilePath))]),s("img",{attrs:{src:e.image.resourcePath,width:"100%"}})]),s("a-modal",{attrs:{title:"上传图片",visible:e.upload.showModal},on:{cancel:e.handleUploadModalCancel,ok:e.handleUploadModalOk}},[s("a-upload",{attrs:{name:"files",accept:"image/*",multiple:!0,withCredentials:!0,listType:"picture",action:"/api/fileSystem/uploadFile",headers:e.headers,data:e.getUploadData()},on:{change:e.handleChange},model:{value:e.fileList,callback:function(a){e.fileList=a},expression:"fileList"}},[s("a-button",{attrs:{type:"primary"}},[s("a-icon",{attrs:{type:"upload"}}),e._v(" 选择图片 ")],1)],1)],1),s("a-modal",{attrs:{title:"新建分析任务",visible:e.analysisModal.showModal,okText:"开始分析"},on:{cancel:e.onClickAnalysisModalCancel,ok:e.onClickAnalysisModalOk}},[s("a-form",{attrs:{form:e.analysisForm,"label-col":{span:5},"wrapper-col":{span:12}}},[s("a-form-item",{attrs:{label:"任务名称"}},[s("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!0,message:"Please input!"}]}],expression:"['name', { rules: [{ required: true, message: 'Please input!' }] }]"}],attrs:{placeholder:"标注此次任务",maxLength:50}})],1),s("a-form-item",{attrs:{label:"ROI阈值"}},[s("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["ROI_fill_thr",{rules:[{required:!0,message:"Please select!"}]}],expression:"['ROI_fill_thr', { rules: [{ required: true, message: 'Please select!' }] }]"}],staticStyle:{width:"100%"},attrs:{min:1,max:10,placeholder:"组织区域阈值"}}),e._v(" 默认值7，可选值>=1 ")],1),s("a-form-item",{attrs:{label:"染色阈值"}},[s("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["stained_thr",{rules:[{required:!0,message:"Please select!"}]}],expression:"[ 'stained_thr', { rules: [{ required: true, message: 'Please select!' }] }]"}],attrs:{placeholder:"染色区域阈值"}},[s("a-select-option",{attrs:{value:"auto"}},[e._v(" auto ")]),s("a-select-option",{attrs:{value:"0.7"}},[e._v(" 0.7 ")])],1),s("span",[e._v('对于Alizarin Red ，建议用"auto"；对于Von Kossa ，建议用0.7')])],1)],1)],1),s("a-drawer",{attrs:{title:"分析结果",placement:"right",closable:!0,maskClosable:!1,width:"90%",visible:e.analysisResult.showModal},on:{close:e.handleAnalysisResultModalClose}},[s("a-card",{attrs:{title:"源图片",hoverable:!0}},[s("strong",{staticStyle:{"font-size":"18px"}},[e._v(e._s(e.analysisResult.result.imageName))]),e._v(" （ 分析结果系统路径 "+e._s(e.analysisResult.result.outputPath)+" ） "),s("div",{staticStyle:{"max-height":"500px"}},[s("img",{attrs:{slot:"cover",src:e.analysisResult.result.imageResourcePath},on:{click:function(a){return e.onClickImage(e.analysisResult.result.name,e.analysisResult.result.imageResourcePath,e.analysisResult.result.imageCanonicalPath)}},slot:"cover"})])]),e._l(e.analysisResult.result.outputItemList,(function(a,t){return s("div",{key:t},[s("a-card",{staticStyle:{"margin-top":"20px"},attrs:{title:e.getAnalysisResultItemTitle(a)}},[s("div",{staticStyle:{"max-height":"500px","overflow-y":"auto"}},[s("a-row",{attrs:{gutter:[16,16]}},e._l(a.outputFiles,(function(a){return s("a-col",{key:a.name,attrs:{span:6}},[s("a-card",{attrs:{hoverable:!0}},[s("img",{attrs:{slot:"cover",src:a.resourcePath},on:{click:function(t){return e.onClickImage(a.name,a.resourcePath,a.canonicalPath)}},slot:"cover"}),s("a-card-meta",[s("template",{slot:"description"},[e._v(" "+e._s(a.name)+" ")])],2)],1)],1)})),1)],1)])],1)}))],2)],1)},l=[],i=(t("a434"),t("b0c0"),t("3b18"),t("f64c")),n=t("1e01"),o=t("b775"),r={saveParam:"/analysis/param/save",removeParam:"/analysis/param/remove",listParam:"/analysis/param/list",startTask:"/analysis/startTask",listAnalysisResult:"/analysis/listAnalysisResult"};function c(a){return Object(o["b"])({url:r.startTask,method:"post",data:a})}function d(a){return Object(o["b"])({url:r.listAnalysisResult,method:"get",params:a})}var u=t("c1df"),m=t.n(u),f={name:"TableList",data:function(){return{collapseActiveKey:["1"],analysisForm:this.$form.createForm(this,{name:"coordinated"}),fileList:[],headers:{authorization:"authorization-text"},image:{name:"",showModal:!1,scr:""},folder:{name:"",showModal:!1},upload:{showModal:!1},breadcrumb:[{name:"全部文件",id:""}],visible:!1,confirmLoading:!1,queryParam:{name:""},dataSource:[],analysisModal:{showModal:!1,formInitParam:{name:"",ROI_fill_thr:7,stained_thr:"auto"}},analysisResult:{showModal:!1,fileId:"",showId:["1"],result:[]},selectedRowKeys:[]}},filters:{},created:function(){this.loadData()},computed:{rowSelection:function(){return{onChange:this.onSelectChange}}},methods:{onSelectChange:function(a){this.selectedRowKeys=a},formatDate:function(a){return m()(a).format("YYYY-MM-DD HH:mm:ss")},showUploadModal:function(){this.upload.showModal=!0},handleUploadModalOk:function(){this.loadData(),this.upload.showModal=!1},handleUploadModalCancel:function(){this.loadData(),this.upload.showModal=!1},getUploadData:function(){return{folderName:this.$route.params.folderName}},handleChange:function(a){a.file.status,"done"===a.file.status?i["a"].success("".concat(a.file.name," file uploaded successfully")):"error"===a.file.status&&i["a"].error("".concat(a.file.name," file upload failed."))},handleFolderModalCancel:function(){this.folder.showModal=!1},handleFolderModalOk:function(){var a=this,e={name:this.folder.name,parentPath:this.queryParam.parentPath};Object(n["a"])(e).then((function(e){a.loadData(),a.folder.showModal=!1}))},clickAddFolder:function(){this.folder.name="",this.folder.showModal=!0},onClickBreadcrumb:function(a){this.queryParam.parentPath=a.id;for(var e=0;e<this.breadcrumb.length;e++)if(this.breadcrumb[e].id===a.id){this.breadcrumb.splice(e+1,this.breadcrumb.length);break}this.loadData()},onClickImage:function(a,e,t){this.image.name=a,this.image.resourcePath=e,this.image.canonicalFilePath=t,this.image.showModal=!0},handleImageModalCancel:function(a){this.image.showModal=!1},deleteFile:function(a){var e=this,t={id:a.id};Object(n["d"])(t).then((function(a){e.loadData()}))},onClickAnalysis:function(a){if(a)this.analysisModal.formInitParam.imageList=[a.name];else{if(!this.selectedRowKeys||0===this.selectedRowKeys.length)return void this.messageConfirm("请选择");this.analysisModal.formInitParam.imageList=this.selectedRowKeys}this.analysisModal.formInitParam.folderName=this.$route.params.folderName,this.analysisModal.showModal=!0,this.resetAnalysisForm()},onClickAnalysisResult:function(a){this.analysisResult.showModal=!0,this.loadAnalysisResult(a)},loadAnalysisResult:function(a){var e=this,t={folderName:this.$route.params.folderName,imageName:a.name};d(t).then((function(a){0===a.code?e.analysisResult.result=a.data:e.$message.error("系统异常，请联系管理员！")}))},getImagePath:function(a){return"/api"+a.path},getAnalysisResultItemTitle:function(a){return"任务名称："+a.taskName},onClickAnalysisModalCancel:function(){this.analysisModal.showModal=!1},onClickAnalysisModalOk:function(){var a=this;this.analysisForm.validateFields((function(e,t){if(e)return!1;var s=t.name,l=a.analysisModal.formInitParam.folderName,i=a.analysisModal.formInitParam.imageList;delete t.name;var n={taskName:s,folderName:l,imageList:JSON.stringify(i),param:JSON.stringify(t)};c(n).then((function(e){0===e.code?(a.onClickAnalysisModalCancel(),a.messageConfirm("任务正在执行中，请稍后查看分析结果")):a.$message.error("任务执行失败，请重试！或请联系管理员！")}))}))},resetAnalysisForm:function(a){var e=this;a||(a=this.analysisModal.formInitParam),this.$nextTick((function(){e.analysisForm.setFieldsValue(a)}))},messageConfirm:function(a){var e=this.$createElement;this.$success({title:"提示",content:e("div",{},[e("p",a)]),onOk:function(){}})},messageError:function(a){var e=this.$createElement;this.$error({title:"异常",content:e("div",{},[e("p",a)]),onOk:function(){}})},loadData:function(a){var e=this,t=Object.assign({folderName:this.$route.params.folderName},this.queryParam);Object(n["c"])(t).then((function(t){e.dataSource=t.data,a&&a()}))},handleAnalysisResultModalClose:function(){this.analysisResult.showModal=!1}}},h=f,p=t("2877"),y=Object(p["a"])(h,s,l,!1,null,null,null);e["default"]=y.exports}}]);